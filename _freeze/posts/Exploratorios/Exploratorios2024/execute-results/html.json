{
  "hash": "8ce552c7038fd652c906047bfebb27ad",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exploratorios 2024\"\nauthor: \"Karen Velásquez-C\"\ndate: 10-05-2024 \nformat:\n  html:\n   message: false\n   warning: false\n   code-fold: false\n   code-tools: true\n   toc: true\n   toc-title: Contenido\n   self-contained: true\n   theme: journal\npage-layout: full\ntitle-block-banner: true\nlang: en\n---\n\n\n## Introducción a exploratorios\n\nPara esta clase emplearemos la paquetería `lterdatasampler` la cual tiene como objetivo proporcionar subconjuntos de datos medioambientales útiles para la enseñanza y la formación en ciencia de datos.\n\n### Instalación paquetería\n\nPodemos instalar la paquetería desde CRAN o la versión en desarrollo en GitHub\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"lterdatasampler\", repos = \"http://cran.us.r-project.org\")\n#remotes::install_github(\"lter/lterdatasampler\")\n```\n:::\n\n\n![](lterdatasampler.jpg){fig-align=\"center\" width=\"250\"}\n\n## Relaciones Univariadas\n\nEmplearemos los datos del cangrejo violinista (*Minuca pugnax*) en marismas de Florida a Massachusetts durante el verano de 2016 en la isla Plum.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(lterdatasampler)\nlibrary(tidyverse)\nlibrary(ggrepel)\nlibrary(ggridges)\nlibrary(patchwork)\n```\n:::\n\n\nPrimero exploraremos la tabla de datos, y observaremos las medias, mínimos, máximos....\n\nmean(crab)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrab <- pie_crab %>% select(where(is.numeric))\nsummary(crab)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    latitude          size          air_temp      air_temp_sd   \n Min.   :30.00   Min.   : 6.64   Min.   :10.29   Min.   :6.391  \n 1st Qu.:34.00   1st Qu.:12.02   1st Qu.:12.05   1st Qu.:8.110  \n Median :39.10   Median :14.44   Median :13.93   Median :8.410  \n Mean   :37.69   Mean   :14.66   Mean   :15.20   Mean   :8.654  \n 3rd Qu.:41.60   3rd Qu.:17.34   3rd Qu.:18.63   3rd Qu.:9.483  \n Max.   :42.70   Max.   :23.43   Max.   :21.79   Max.   :9.965  \n   water_temp    water_temp_sd  \n Min.   :13.98   Min.   :4.838  \n 1st Qu.:14.33   1st Qu.:6.567  \n Median :17.50   Median :6.998  \n Mean   :17.65   Mean   :7.252  \n 3rd Qu.:20.54   3rd Qu.:7.865  \n Max.   :24.50   Max.   :9.121  \n```\n\n\n:::\n:::\n\n\nPodemos centrarnos en una única variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(crab$size)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   6.64   12.02   14.44   14.66   17.34   23.43 \n```\n\n\n:::\n:::\n\n\n## Boxplot\n\n### Boxplot básico\n\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(crab$size, range=1.5, ylab=\"Size\")\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/boxplot-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrab2 <- stack(crab)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfilter(crab2, ind == \"size\") %>% #selecciono variable que me importa\n  ggplot(aes(x= ind, y= values))+ # Creo la capa de datos\n  geom_boxplot(outlier.color = \"red\", #color de outlier\n               fill= \"gray\")+ # color de la caja\n#  geom_text(aes(label= values), position = position_dodge2(0.3))+\n  labs(title = \" Boxplot de tamaño\",\n       y= \" Valores\",\n       x= \"\")+\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/boxplot 3-1.png){width=672}\n:::\n:::\n\n\nUna buena regla de dedo para identificar datos atípicos es: que los puntos que caen mas allá del 3er+1.5\\*(intercuartil) o mas bajo que 1er-1.5\\*(intercuartil) son valores atípicos.\n\n#### Ejemplo:\n\n\n::: {.cell}\n\n```{.r .cell-code}\niqsize <- 17.34-12.02\natip_inf <-(12.02-(iqsize*1.5))\natip_inf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4.04\n```\n\n\n:::\n\n```{.r .cell-code}\natip_sup <- (17.34+(iqsize*1.5))\natip_sup\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 25.32\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(crab)\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/boxplot todos-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nboxplot(log(crab+1))\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/todos log-1.png){width=672}\n:::\n:::\n\n\nEn ggplot tenemos que usar la base de datos que tenemos en formato “long”\n\n\n::: {.cell}\n\n```{.r .cell-code}\n ggplot(crab2, aes(x= ind, y= values, fill= ind))+ # Creo la capa de datos\n  geom_boxplot(outlier.color = \"red\") # color outlier\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/ggplot todos-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#  geom_text(aes(label= values), position = position_dodge2(0.3))+\n  labs(title = \" Boxplot de tamaño\",\n       y= \" Valores\",\n       x= \"\")+\n  theme_classic()#+\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\n # theme(legend.position =\"none\") # leyendas variable\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab2, aes(x= ind, y= log(values+1), fill= ind))+ # Creo la capa de datos\n  geom_boxplot(outlier.color = \"red\", notch = TRUE) # color outlier\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/ggplot todos log-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#  geom_text(aes(label= values), position = position_dodge2(0.3))+\n  labs(title = \" Boxplot de tamaño\",\n       y= \" Valores\",\n       x= \"\")+\n  theme_classic()#+\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nNULL\n```\n\n\n:::\n\n```{.r .cell-code}\n # theme(legend.position =\"none\") # leyendas variable\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab2, aes(x=ind, y= log(values+1), fill=ind))+\n  geom_violin()+ # geometría de violin\n  geom_jitter(aes(col= ind), alpha= 0.6)+\n    labs(title = \"Gráfico de violín\", \n         x= \"\", y= \"variables scala log\")+\n  theme_minimal()+\n  theme(legend.position = \"none\") #quitar leyenda de variables\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/violín-1.png){width=672}\n:::\n:::\n\n\n#### Ahora en conjunto\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab2, aes(x=ind, y= log(values+1)))+\n  geom_jitter( aes(color=ind),width = 0.2, alpha= 0.6)+\n  geom_violin(aes(color=ind),\n              scale = \"width\", \n              alpha= 0.1, # valor de opacidad\n              size= 0.8)+ # tamaño de la linea\n  geom_boxplot(width = 0.3, alpha= 0.1, size= 0.8,\n               outlier.color = \"red\",\n               outlier.alpha = 0.9,\n               outlier.size = 2)+\n  labs(title = \"Gráfico conjunto\", \n       x= \"\", y= \"Variables scala log\")+\n  theme_bw()+\n  theme(legend.position = \"none\", # quitar leyenda de variables\n       text = element_text(size= 11, face = \"bold\")) # Ajustar tamaño de texto\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/conjunto-1.png){width=672}\n:::\n:::\n\n\n## Dotplots\n\n#### Con base R\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndotchart(crab$size, \n         ylab = \"Order of observations\", \n         xlab = \"SO2\", \n         main = \"Cleveland dotplot\")\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/dotchart-1.png){width=672}\n:::\n:::\n\n\n#### Modo ggplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nd_plot <-  crab %>% \n   mutate(index = seq(n())) %>%\n  select_if(is.numeric) %>% \n  pivot_longer(cols = !index, \n               names_to = \"Variable\", \n               values_to = \"Value\") %>%\n  ggplot(aes(x= Value, y= index, col= Variable))+\n  geom_point(size= 2, alpha=0.6)+\n  scale_color_viridis_d(option = \"mako\", \n                        begin = 0.1,\n                        end = 0.8)+\n  facet_wrap(~Variable, scales = \"free\")+\n  labs(y= \"Order of ovservation\")+\n   theme_bw()+\n   theme(legend.position = \"none\",\n         text = element_text(size=10))\n```\n:::\n\n\n## Histogramas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhist(crab$size,lwd=2)\nabline(v = 14.65, col = \"blue\")\nabline(v = 14.435, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/histograma 1-1.png){width=672}\n:::\n:::\n\n\n#### Todas las variables juntas (base R)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npar(mfrow=c(3,2))\nhist(crab$size,lwd=2); abline(v = c(14.65,14.435), col = c(\"blue\", \"red\"))\nhist(crab$latitude,lwd=2)\nhist(crab$air_temp,lwd=2)\nhist(crab$air_temp_sd,lwd=2)\nhist(crab$water_temp,lwd=2)\nhist(crab$water_temp_sd,lwd=2)\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/hist juntos base R-1.png){width=672}\n:::\n:::\n\n\n#### Modo ggplot\n\nVolvemos a emplear nuestra base `crab2` en modo largo\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab2, aes(x=values, fill= ind))+\n  geom_histogram( bins = 7, color=\"black\")+\n  facet_wrap(.~ind, scales = \"free\")+ # Crear los paneles por variable\n  theme_bw()+\n  theme(legend.position = \"none\")+\n  labs(x=\"\", y= \" Frequency\")\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/hist junto ggplot-1.png){width=672}\n:::\n:::\n\n\n## Gráficos de densidad\n\n#### ggplot de una variable\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab, aes(x= size))+\n  geom_histogram(aes(y = stat(density)), \n                 bins = 7,\n                 fill= \"gray\",\n                 color=\"black\")+\n  geom_density(size=1)+\n  theme_classic()\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/densidad size-1.png){width=672}\n:::\n:::\n\n\n#### ggplot de todas las variables \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab2, aes(x=log(values+1), fill= ind))+\n  geom_histogram(aes(y = stat(density), fill= ind), \n                 bins = 7, color=\"black\")+\n  geom_density(aes(fill= ind),\n               size=1, alpha= 0.5)+\n  facet_wrap(.~ind, scales = \"free\")+ # Crear los paneles por variable\n  theme_classic()+\n  theme(legend.position = \"none\")+\n  labs(x=\"\", y= \" Frequency\")\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/densidad ggplot todas-1.png){width=672}\n:::\n:::\n\n\nAhora pondremos las variables a la misma escala y las exploraremos con un gráfico de olas\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab2, aes(x= log(values+1), y= ind, fill= ind))+\n  geom_density_ridges()+\n  theme_ridges() + \n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/todas grafico olas-1.png){width=672}\n:::\n:::\n\n\n## QQ-plots\n\nPrimero con plot base\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqqnorm(crab$size, main=\"Q-Q plot Size\")\nqqline(crab$size, col = 2, lty = 2)\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/qqplot size base-1.png){width=672}\n:::\n:::\n\n\n#### modo ggplot para QQplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(crab, aes(sample=size))+\n  stat_qq()+\n  stat_qq_line(linetype= \"dashed\")+\n    labs(title = \"Q-Q plot\", \n       x= \"Theoretical Quantiles\", \n       y= \"Education sample cuantiles\")+\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/qqplot ggplot-1.png){width=672}\n:::\n:::\n\n\n## Relaciones Bivariadas\n\nVeamos que relación hay entre las distintas variables. Aquí utilizo una función smoooth (regresión con pesos locales) que permite sugerir con los propios datos que tipo de relación pudieran tener.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(crab, panel=panel.smooth)\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/panel bivariado-1.png){width=672}\n:::\n:::\n\n\nVeamos la relación entre el tamaño de los cangrejos y la latitud\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = pie_crab, aes(y = latitude, x = water_temp)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/bivariado size latitud-1.png){width=672}\n:::\n:::\n\n\nEn general, la temperatura del agua dentro del área de estudio disminuye hacia latitudes más bajas.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrab_stats <- pie_crab %>% group_by(latitude, site) %>% \n  summarise(\n  n = n(), \n  mean_mm = mean(size),\n  min_mm = min(size),\n  max_mm = max(size),\n  sd_mm = sd(size),\n  median_mm = median(size)\n  ) \n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrab_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 13 × 8\n# Groups:   latitude [13]\n   latitude site      n mean_mm min_mm max_mm sd_mm median_mm\n      <dbl> <chr> <int>   <dbl>  <dbl>  <dbl> <dbl>     <dbl>\n 1     30   GTM      28   12.4    7.55   14.9  1.80     12.6 \n 2     31.4 SI       30    9.85   6.64   13.6  1.79      9.55\n 3     33.3 NIB      30   13.3    8.52   17.3  2.42     13.3 \n 4     34   ZI       35   12.1    8.05   15.7  2.01     12.0 \n 5     34.7 RC       25   12.5    9.4    17.6  2.34     12.1 \n 6     37.2 VCR      30   16.3   11.7    21.4  2.94     16.0 \n 7     39.1 DB       30   15.6   11.5    20.4  2.12     15.1 \n 8     39.6 JC       30   15.3    9.58   20.9  2.72     15.4 \n 9     41.3 CT       33   14.7   11.0    19.5  2.36     15.5 \n10     41.6 NB       29   17.1   13.2    21.9  2.29     17.2 \n11     41.9 CC       27   16.8   10.6    19.8  2.05     16.7 \n12     42.2 BC       37   16.2    9.01   23.4  4.81     17.3 \n13     42.7 PIE      28   18.5    9.92   22.1  2.30     18.4 \n```\n\n\n:::\n:::\n\n\nAquí, creamos un boxplot del tamaño del caparazón del cangrejo (mm) por latitud. En general, el tamaño de los cangrejos aumenta hacia latitudes más altas, siguiendo la regla de Bergmann.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npie_crab %>%\n  ggplot(aes(y=latitude)) +\n  geom_boxplot(aes(size, group = latitude, color=-latitude), outlier.size=0.8) +\n  geom_text(data = crab_stats,\n            aes(label = (paste('n =', n)), \n                group = latitude, \n                color = -latitude, \n                x= max_mm + 0.2, \n                y= latitude + 0.15), \n            size=3.5) +\n  scale_x_continuous(breaks = seq(from = 7, to = 23, by = 2), limits = c(6.5,24))+\n  scale_y_continuous(breaks = seq(from = 29, to = 43, by = 2), limits = c(29, 43.5)) +\n  theme(legend.position= \"none\") \n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncrab_summary <- pie_crab %>% group_by(site, latitude) %>%\n  summarise(\n    mean_size = mean(size)\n    ) %>% ungroup()\n```\n:::\n\n\nA continuación se muestra otro gráfico del tamaño del caparazón (mm) según la latitud del lugar, con los tamaños medios registrados para cada lugar mostrados como puntos morados (todas las observaciones incluidas como puntos gris claro), lo que revela una relación aproximadamente lineal entre el tamaño medio del caparazón y la latitud.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = crab_summary, aes(y = latitude, x = mean_size)) +\n  geom_point() +\n  geom_smooth(method = \"lm\", se = FALSE, color=\"black\") +\n  geom_point(color = \"purple\", size=3) +\n  geom_point(aes(x = size, y = latitude), data = pie_crab, color = \"gray\", alpha = 0.5) +\n  geom_text(aes(label = site), nudge_x = 0.3, nudge_y = 0.3, size=3) +\n  labs(y = \"Latitude\", \n       x = \"Mean carapace width (mm)\",\n       title = \"Mean carapace width of male fiddler crabs by latitude\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](Exploratorios2024_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "Exploratorios2024_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}